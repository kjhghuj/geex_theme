{%- comment -%}
  科幻主题 Meta Tags
  包含SEO优化和社交媒体meta标签
{%- endcomment -%}

{%- if current_tags -%}
  {%- assign meta_tags = current_tags | join: ', ' -%}
  <meta name="keywords" content="{{ meta_tags | escape }}{% if template.name == 'product' %}, {{ product.title | escape }}, {{ product.type | escape }}, {{ product.vendor | escape }}{% endif %}">
{%- endif -%}

{%- if template.name == 'product' -%}
  <meta name="keywords" content="{{ product.title | escape }}, {{ product.type | escape }}, {{ product.vendor | escape }}, {{ shop.name | escape }}">

  {%- if product.featured_image -%}
    <meta property="og:image" content="http:{{ product.featured_image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:secure_url" content="https:{{ product.featured_image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:card" content="product">
    <meta name="twitter:label1" content="Price">
    <meta name="twitter:data1" content="{{ product.price | money_with_currency }}">
    {%- if product.variants.first.available -%}
      <meta name="twitter:label2" content="Availability">
      <meta name="twitter:data2" content="In stock">
    {%- endif -%}
  {%- endif -%}

  {%- if product.variants.first.available -%}
    <meta property="og:availability" content="instock">
  {%- else -%}
    <meta property="og:availability" content="oos">
  {%- endif -%}

  <meta property="product:price:amount" content="{{ product.price | money_without_currency }}">
  <meta property="product:price:currency" content="{{ shop.currency }}">

{%- elsif template.name == 'article' -%}
  {%- if article.image -%}
    <meta property="og:image" content="http:{{ article.image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:secure_url" content="https:{{ article.image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
  {%- endif -%}

  {%- if article.excerpt != blank -%}
    <meta name="description" content="{{ article.excerpt | strip_html | truncate: 160 | escape }}">
  {%- endif -%}

  <meta property="article:published_time" content="{{ article.published_at | date: '%Y-%m-%dT%H:%M:%S' }}">
  <meta property="article:modified_time" content="{{ article.updated_at | date: '%Y-%m-%dT%H:%M:%S' }}">

{%- elsif template.name == 'collection' -%}
  {%- if collection.image -%}
    <meta property="og:image" content="http:{{ collection.image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:secure_url" content="https:{{ collection.image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
  {%- endif -%}

{%- endif -%}

{%- if page_title -%}
  <meta property="og:title" content="{{ page_title | escape }}">
{%- endif -%}

{%- if page_description -%}
  <meta property="og:description" content="{{ page_description | escape }}">
{%- endif -%}

<meta property="og:type" content="{% if template.name == 'product' %}product{% elsif template.name == 'article' %}article{% else %}website{% endif %}">
<meta property="og:site_name" content="{{ shop.name }}">
<meta property="og:url" content="{{ canonical_url }}">
<meta property="og:locale" content="{{ request.locale.iso_code }}">

{%- if settings.social_twitter_link != blank -%}
  <meta name="twitter:site" content="{{ settings.social_twitter_link | split: '/' | last }}">
  <meta name="twitter:creator" content="{{ settings.social_twitter_link | split: '/' | last }}">
{%- endif -%}

{%- if template.name == 'product' and product.featured_image -%}
  <meta name="twitter:image" content="https:{{ product.featured_image | image_url: width: 600, height: 600 }}">
{%- endif -%}

{%- comment -%}
  结构化数据 - Product Schema
{%- endcomment -%}
{%- if template.name == 'product' -%}
  {%- assign first_variant = product.variants | first -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": {{ product.title | json }},
    "description": {{ product.description | strip_html | json }},
    "url": {{ shop.url | append: product.url | json }},
    "image": [
      {%- for image in product.images -%}
        {{ image | image_url: width: 800 | prepend: "https:" | json }}{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    ],
    "brand": {
      "@type": "Brand",
      "name": {{ product.vendor | json }}
    },
    "sku": {{ first_variant.sku | json }},
    "mpn": {{ first_variant.barcode | json }},
    "offers": [
      {%- for variant in product.variants -%}
        {
          "@type" : "Offer",
          "availability" : "https://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
          "price" : {{ variant.price | divided_by: 100.00 | json }},
          "priceCurrency" : {{ shop.currency | json }},
          "priceValidUntil": {{ "now" | date: '%s' | plus: 31536000 | date: "%Y-%m-%d" | json }},
          "url": {{ shop.url | append: variant.url | json }},
          "itemCondition" : "https://schema.org/NewCondition",
          "seller": {
            "@type": "Organization",
            "name": {{ shop.name | json }}
          }
        }{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    ],
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "{{ product.metafields.reviews.rating.value }}",
      "reviewCount": "{{ product.metafields.reviews.rating_count.value }}"
    }
  }
  </script>
{%- endif -%}

{%- comment -%}
  结构化数据 - Organization Schema
{%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  "logo": {{ 'logo.png' | asset_url | prepend: "https:" | json }},
  "sameAs": [
    {%- if settings.social_twitter_link != blank -%}
      {{ settings.social_twitter_link | json }}{%- unless forloop.last -%},{%- endunless -%}
    {%- endif -%}
    {%- if settings.social_facebook_link != blank -%}
      {{ settings.social_facebook_link | json }}{%- unless forloop.last -%},{%- endunless -%}
    {%- endif -%}
    {%- if settings.social_instagram_link != blank -%}
      {{ settings.social_instagram_link | json }}{%- unless forloop.last -%},{%- endunless -%}
    {%- endif -%}
    {%- if settings.social_youtube_link != blank -%}
      {{ settings.social_youtube_link | json }}{%- unless forloop.last -%},{%- endunless -%}
    {%- endif -%}
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": {{ settings.contact_phone | json }},
    "contactType": "customer service",
    "availableLanguage": "{{ request.locale.iso_code }}"
  }
}
</script>

{%- comment -%}
  科幻主题特定meta标签
{%- endcomment -%}
<meta name="theme-name" content="Sci-Fi Store Theme">
<meta name="theme-version" content="1.0.0">
<meta name="theme-author" content="Claude Code">
<meta name="theme-color" content="{{ settings.color_secondary | default: '#87ceeb' }}">

{%- if template contains 'customers' -%}
  <meta name="shopify-checkout-api-token" content="{{ shop.checkout.api_token }}">
  <meta id="shopify-digital-wallet" name="shopify-digital-wallet" content="{{ shop.digital_wallet }}"/>
  <script src="{{ 'shopify_common.js' | shopify_asset_url }}" defer="defer"></script>
  <script src="{{ 'customer_area.js' | shopify_asset_url }}" defer="defer"></script>
  {{ 'shopify_common.js' | asset_url | script_tag }}
  {{ 'customer_area.js' | asset_url | script_tag }}
{%- endif -%}