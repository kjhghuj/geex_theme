{% comment %}
  ç¤¾äº¤åª’ä½“åˆ†äº«ç»„ä»¶
  æä¾›å¤šç§ç¤¾äº¤å¹³å°çš„åˆ†äº«åŠŸèƒ½

  Parameters:
  - share_title: åˆ†äº«æ ‡é¢˜
  - share_permalink: åˆ†äº«é“¾æ¥
  - share_image: åˆ†äº«å›¾ç‰‡
  - share_description: åˆ†äº«æè¿°ï¼ˆå¯é€‰ï¼‰
{% endcomment %}

{% assign share_title = share_title | default: page_title | url_param_escape %}
{% assign share_permalink = share_permalink | default: canonical_url | url_param_escape %}
{% assign share_image = share_image | default: featured_image | image_url: width: 1200 | url_param_escape %}
{% assign share_description = share_description | default: page_description | url_param_escape %}

<div class="social-sharing" aria-label="{{ 'general.social.share_on_social' | t }}">
  <h3 class="social-sharing__title">{{ 'general.social.share' | t }}</h3>
  <ul class="social-sharing__list">
    <!-- Facebook -->
    <li class="social-sharing__item">
      <a href="https://www.facebook.com/sharer/sharer.php?u={{ share_permalink }}&title={{ share_title }}"
         class="social-sharing__link social-sharing__link--facebook"
         target="_blank"
         rel="noopener noreferrer"
         aria-label="{{ 'general.social.share_on_facebook' | t }}"
         data-platform="facebook">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M18 2H2C0.9 2 0 2.9 0 4v12c0 1.1 0.9 2 2 2h6v-6H6V9h2V7c0-2 1.2-3 3-3h2v3h-2c-0.6 0-1 0.4-1 1v1h3l-0.5 3H10v6h8c1.1 0 2-0.9 2-2V4c0-1.1-0.9-2-2-2z"/>
        </svg>
        <span class="social-sharing__label">Facebook</span>
      </a>
    </li>

    <!-- Twitter -->
    <li class="social-sharing__item">
      <a href="https://twitter.com/intent/tweet?text={{ share_title }}&url={{ share_permalink }}"
         class="social-sharing__link social-sharing__link--twitter"
         target="_blank"
         rel="noopener noreferrer"
         aria-label="{{ 'general.social.share_on_twitter' | t }}"
         data-platform="twitter">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M18 4.5c-.7.3-1.5.5-2.3.6.8-.5 1.5-1.3 1.8-2.3-.8.5-1.7.8-2.6 1-.7-.8-1.8-1.3-3-1.3-2.3 0-4.1 1.8-4.1 4.1 0 .3 0 .6.1.9-3.4-.2-6.4-1.8-8.4-4.3-.4.6-.6 1.3-.6 2.1 0 1.4.7 2.7 1.8 3.4-.7 0-1.3-.2-1.9-.5v.1c0 2 1.4 3.6 3.3 4-.3.1-.7.1-1.1.1-.3 0-.5 0-.8-.1.5 1.6 2 2.8 3.8 2.8-1.4 1.1-3.2 1.8-5.1 1.8-.3 0-.7 0-1-.1 1.8 1.2 4 1.8 6.3 1.8 7.5 0 11.6-6 11.6-6 0-.2 0-.3 0-.5.8-.6 1.5-1.3 2.1-2.1z"/>
        </svg>
        <span class="social-sharing__label">Twitter</span>
      </a>
    </li>

    <!-- LinkedIn -->
    <li class="social-sharing__item">
      <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ share_permalink }}"
         class="social-sharing__link social-sharing__link--linkedin"
         target="_blank"
         rel="noopener noreferrer"
         aria-label="{{ 'general.social.share_on_linkedin' | t }}"
         data-platform="linkedin">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M18 2H2C0.9 2 0 2.9 0 4v12c0 1.1 0.9 2 2 2h16c1.1 0 2-0.9 2-2V4c0-1.1-0.9-2-2-2zM6 16H3V8h3v8zM4.5 6.8c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8 1.8.8 1.8 1.8-.8 1.8-1.8 1.8zM17 16h-3v-4c0-1 0-2.3-1.4-2.3s-1.6 1.1-1.6 2.3v4h-3V8h3v1.1c.4-.8 1.4-1.6 2.9-1.6 3.1 0 3.7 2 3.7 4.6V16z"/>
        </svg>
        <span class="social-sharing__label">LinkedIn</span>
      </a>
    </li>

    <!-- Pinterest -->
    <li class="social-sharing__item">
      <a href="https://pinterest.com/pin/create/button/?url={{ share_permalink }}&description={{ share_title }}&media={{ share_image }}"
         class="social-sharing__link social-sharing__link--pinterest"
         target="_blank"
         rel="noopener noreferrer"
         aria-label="{{ 'general.social.share_on_pinterest' | t }}"
         data-platform="pinterest">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10 0C4.5 0 0 4.5 0 10s4.5 10 10 10 10-4.5 10-10S15.5 0 10 0zm2.3 6.5c-.3 0-.6.1-.8.2-.2.1-.5.3-.6.5-.2.2-.3.5-.3.8s.1.6.2.8c.1.2.3.4.6.6.3.2.6.3.9.4.3.1.7.1 1.1.1.3 0 .6 0 .9-.1s.5-.2.7-.3c.2-.1.4-.2.5-.4.1-.1.2-.3.2-.5s-.1-.4-.2-.6c-.1-.2-.3-.3-.5-.4s-.5-.2-.8-.2c-.2 0-.4 0-.6-.1s-.3-.1-.4-.2c-.1-.1-.2-.2-.2-.3s0-.2.1-.3.1-.2.2-.2c.1 0 .2-.1.4-.1s.3 0 .5.1.3.1.4.2c.1.1.3.2.4.3s.2.2.3.2.3.1.4.1c.2 0 .3 0 .4-.1s.2-.2.2-.3c0-.2-.1-.4-.3-.6s-.5-.3-.8-.4c-.4-.1-.7-.2-1.2-.2zm-.3 4.1c-.3 0-.6.1-.9.2s-.5.2-.7.4c-.2.2-.4.4-.5.6s-.2.5-.2.8c0 .3.1.5.2.7s.3.4.5.5.4.2.7.2c.3 0 .5-.1.7-.2s.3-.2.4-.3c.1-.1.2-.3.2-.4s0-.3-.1-.4c-.1-.1-.2-.2-.3-.2s-.3-.1-.4-.1c-.1 0-.2 0-.3.1s-.1.1-.1.2c0 .1.1.2.1.3s.2.2.3.2.2.1.3.2c.1.1.2.1.2.2s.1.2.1.3c0 .2-.1.3-.2.4s-.3.2-.5.2-.4-.1-.5-.2c-.1-.1-.2-.3-.2-.5s.1-.4.2-.6.3-.3.5-.5.4-.3.7-.4.5-.2.9-.2c.3 0 .7.1 1 .2s.5.3.7.5.3.5.3.8c0 .3-.1.6-.3.8s-.5.4-.8.5-.7.2-1.1.2c-.4 0-.8-.1-1.1-.2s-.6-.3-.8-.5-.4-.5-.4-.8-.1-.6-.1-.9c0-.3.1-.6.3-.9s.4-.5.7-.7.6-.4 1-.5.8-.2 1.3-.2c.3 0 .6 0 .9.1s.5.2.7.3c.2.1.4.3.5.4s.2.3.2.5-.1.3-.2.4-.3.1-.4.1c-.2 0-.3 0-.4-.1s-.2-.2-.3-.3c-.1-.1-.2-.2-.4-.3s-.4-.1-.6-.1z"/>
        </svg>
        <span class="social-sharing__label">Pinterest</span>
      </a>
    </li>

    <!-- WhatsApp -->
    <li class="social-sharing__item">
      <a href="https://wa.me/?text={{ share_title }}%20{{ share_permalink }}"
         class="social-sharing__link social-sharing__link--whatsapp"
         target="_blank"
         rel="noopener noreferrer"
         aria-label="{{ 'general.social.share_on_whatsapp' | t }}"
         data-platform="whatsapp">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M17.7 2.3C15.7 0.8 13.2 0 10.5 0 5.1 0 0.7 4.3 0.7 9.8c0 1.7 0.5 3.4 1.3 4.9L0 20l5.4-1.4c1.4 0.8 3 1.2 4.6 1.2h0c5.4 0 9.8-4.3 9.8-9.8 0-2.6-1-5.1-2.6-6.9zM10.5 18.4h0c-1.4 0-2.8-0.4-4-1.1l-0.3-0.2-3 0.8 0.8-2.9-0.2-0.3c-0.8-1.3-1.2-2.8-1.2-4.3 0-4.4 3.6-8 8-8 2.1 0 4.1 0.8 5.6 2.3 1.5 1.5 2.3 3.5 2.3 5.6 0.1 4.4-3.5 8-8 8z"/>
          <path d="M15.8 12.4c-0.2-0.1-1.3-0.7-1.5-0.7s-0.4-0.1-0.5 0.1-0.6 0.7-0.7 0.9-0.3 0.2-0.5 0.1c-0.2-0.1-0.9-0.3-1.8-1.1-0.7-0.6-1.1-1.3-1.3-1.5s0-0.4 0.1-0.5 0.2-0.2 0.3-0.3 0.2-0.1 0.3-0.1c0.1 0 0.2 0 0.3 0.1s0.9 0.4 1 0.4 0.4 0.1 0.5 0c0.1-0.1 0.4-0.4 0.5-0.6s0.2-0.4 0.3-0.5c0.1-0.2 0-0.3 0-0.4s-0.3-0.2-0.4-0.3-0.6-0.2-1-0.2-0.7 0.1-1.1 0.5c-0.4 0.4-1.1 1.1-1.1 2.6s1.1 3 1.3 3.2c0.1 0.2 2.3 3.5 5.5 4.9 0.8 0.3 1.4 0.5 1.9 0.7 0.8 0.2 1.5 0.2 2 0.1 0.6-0.1 1.3-0.5 1.6-1 0.3-0.5 0.3-0.9 0.2-1s-0.2-0.2-0.4-0.3z"/>
        </svg>
        <span class="social-sharing__label">WhatsApp</span>
      </a>
    </li>

    <!-- å¤åˆ¶é“¾æ¥ -->
    <li class="social-sharing__item">
      <button type="button"
              class="social-sharing__link social-sharing__link--copy"
              data-copy-link="{{ share_permalink }}"
              aria-label="{{ 'general.social.copy_link' | t }}"
              data-platform="copy">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M14 4H8C7.4 4 7 4.4 7 5v11c0 0.6 0.4 1 1 1h10c0.6 0 1-0.4 1-1V5c0-0.6-0.4-1-1-1h-2z"/>
          <path d="M4 12H3c-0.6 0-1-0.4-1-1V3c0-0.6 0.4-1 1-1h8c0.6 0 1 0.4 1 1v1"/>
        </svg>
        <span class="social-sharing__label">{{ 'general.social.copy' | t }}</span>
      </button>
    </li>

    <!-- é‚®ä»¶åˆ†äº« -->
    <li class="social-sharing__item">
      <a href="mailto:?subject={{ share_title }}&body={{ share_description }}%20{{ share_permalink }}"
         class="social-sharing__link social-sharing__link--email"
         aria-label="{{ 'general.social.share_by_email' | t }}"
         data-platform="email">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M18 2H2C0.9 2 0 2.9 0 4v12c0 1.1 0.9 2 2 2h16c1.1 0 2-0.9 2-2V4c0-1.1-0.9-2-2-2zM2 4l8 5 8-5v12H2V4z"/>
        </svg>
        <span class="social-sharing__label">Email</span>
      </a>
    </li>
  </ul>

  <!-- åˆ†äº«æˆåŠŸæç¤º -->
  <div class="social-sharing__toast" hidden>
    {{ 'general.social.link_copied' | t }}
  </div>
</div>

<style>
  .social-sharing {
    margin: var(--spacing-6) 0;
    padding: var(--spacing-6);
    background: var(--color-bg-secondary);
    border-radius: var(--radius-lg);
    @include scifi-card();
  }

  .social-sharing__title {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-4);
    display: flex;
    align-items: center;
    gap: var(--spacing-2);

    &::before {
      content: 'ğŸ”—';
      font-size: var(--font-size-xl);
    }
  }

  .social-sharing__list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-3);
    align-items: center;
  }

  .social-sharing__item {
    display: flex;
  }

  .social-sharing__link {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    padding: var(--spacing-3) var(--spacing-4);
    background: var(--color-bg-primary);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-full);
    color: var(--color-text-primary);
    text-decoration: none;
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    transition: all var(--duration-normal) var(--ease-out);
    white-space: nowrap;

    &:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    &:focus {
      outline: none;
      @include glow(var(--glow-size-small, var(--color-secondary), 0.3);
    }

    // å¹³å°ç‰¹å®šé¢œè‰²
    &--facebook:hover {
      border-color: #1877f2;
      color: #1877f2;
      @include glow(var(--glow-size-small, #1877f2, 0.4);
    }

    &--twitter:hover {
      border-color: #1da1f2;
      color: #1da1f2;
      @include glow(var(--glow-size-small, #1da1f2, 0.4);
    }

    &--linkedin:hover {
      border-color: #0077b5;
      color: #0077b5;
      @include glow(var(--glow-size-small, #0077b5, 0.4);
    }

    &--pinterest:hover {
      border-color: #e60023;
      color: #e60023;
      @include glow(var(--glow-size-small, #e60023, 0.4);
    }

    &--whatsapp:hover {
      border-color: #25d366;
      color: #25d366;
      @include glow(var(--glow-size-small, #25d366, 0.4);
    }

    &--email:hover {
      border-color: var(--color-secondary);
      color: var(--color-secondary);
      @include glow(var(--glow-size-small, var(--color-secondary), 0.4);
    }

    &--copy:hover {
      border-color: var(--color-success);
      color: var(--color-success);
      @include glow(var(--glow-size-small, var(--color-success), 0.4);
    }

    // å¤åˆ¶æŒ‰é’®æ¿€æ´»çŠ¶æ€
    &.copied {
      border-color: var(--color-success);
      color: var(--color-success);
      @include glow(var(--glow-size-small, var(--color-success), 0.6);

      .social-sharing__label::before {
        content: 'âœ“ ';
      }
    }
  }

  .social-sharing__label {
    transition: color var(--duration-fast) var(--ease-out);
  }

  .social-sharing__toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--color-success);
    color: var(--color-text-inverse);
    padding: var(--spacing-3) var(--spacing-4);
    border-radius: var(--radius-lg);
    font-weight: var(--font-weight-medium);
    z-index: var(--z-toast);
    transform: translateX(100%);
    transition: transform var(--duration-normal) var(--ease-out);
    @include glow(var(--glow-size-small, var(--color-success), 0.5);

    &.show {
      transform: translateX(0);
    }
  }

  /* å“åº”å¼è®¾è®¡ */
  @include mobile-only {
    .social-sharing {
      margin: var(--spacing-4) 0;
      padding: var(--spacing-4);
    }

    .social-sharing__list {
      gap: var(--spacing-2);
    }

    .social-sharing__link {
      padding: var(--spacing-2) var(--spacing-3);
      font-size: var(--font-size-xs);

      svg {
        width: 16px;
        height: 16px;
      }

      .social-sharing__label {
        display: none;
      }
    }

    // ç§»åŠ¨ç«¯æ˜¾ç¤ºå›¾æ ‡çš„å·¥å…·æç¤º
    .social-sharing__link {
      position: relative;

      &:hover::after {
        content: attr(data-platform);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: var(--color-bg-dark);
        color: var(--color-text-inverse);
        padding: var(--spacing-1) var(--spacing-2);
        border-radius: var(--radius-base);
        font-size: var(--font-size-xs);
        white-space: nowrap;
        z-index: var(--z-tooltip);
        margin-bottom: var(--spacing-1);
      }
    }
  }

  @include respond-to('md') {
    .social-sharing__list {
      justify-content: center;
    }
  }

  // é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ
  @media (prefers-contrast: high) {
    .social-sharing__link {
      border-width: 3px;
      font-weight: var(--font-weight-bold);
    }
  }

  // å‡å°‘åŠ¨ç”»åå¥½æ”¯æŒ
  @media (prefers-reduced-motion: reduce) {
    .social-sharing__link {
      transition: color var(--duration-fast) var(--ease-out);

      &:hover {
        transform: none;
      }
    }

    .social-sharing__toast {
      transition: transform var(--duration-fast) var(--ease-out);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // å¤åˆ¶é“¾æ¥åŠŸèƒ½
    const copyButton = document.querySelector('[data-copy-link]');
    const toast = document.querySelector('.social-sharing__toast');

    if (copyButton && toast) {
      copyButton.addEventListener('click', async function(e) {
        e.preventDefault();

        const linkToCopy = this.dataset.copyLink;
        const linkElement = this;

        try {
          // å°è¯•ä½¿ç”¨ç°ä»£å‰ªè´´æ¿API
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(linkToCopy);
          } else {
            // å›é€€æ–¹æ¡ˆ
            const textArea = document.createElement('textarea');
            textArea.value = linkToCopy;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            document.execCommand('copy');
            textArea.remove();
          }

          // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
          linkElement.classList.add('copied');

          // æ˜¾ç¤ºæç¤º
          toast.classList.add('show');

          // 3ç§’åé‡ç½®çŠ¶æ€
          setTimeout(() => {
            linkElement.classList.remove('copied');
            toast.classList.remove('show');
          }, 3000);

        } catch (error) {
          console.error('å¤åˆ¶é“¾æ¥å¤±è´¥:', error);

          // æ˜¾ç¤ºé”™è¯¯æç¤º
          toast.textContent = 'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥';
          toast.style.background = 'var(--color-error)';
          toast.classList.add('show');

          setTimeout(() => {
            toast.classList.remove('show');
            // æ¢å¤åŸå§‹æ–‡æœ¬
            setTimeout(() => {
              toast.style.background = '';
              toast.textContent = toast.dataset.originalText || 'é“¾æ¥å·²å¤åˆ¶';
            }, 300);
          }, 3000);
        }
      });
    }

    // åˆ†äº«é“¾æ¥ç‚¹å‡»äº‹ä»¶è¿½è¸ª
    const shareLinks = document.querySelectorAll('.social-sharing__link[data-platform]');

    shareLinks.forEach(link => {
      if (link.tagName === 'A') {
        link.addEventListener('click', function() {
          const platform = this.dataset.platform;

          // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼ˆç”¨äºåˆ†æè¿½è¸ªï¼‰
          const shareEvent = new CustomEvent('socialShare', {
            detail: {
              platform: platform,
              url: this.href,
              title: '{{ share_title }}'
            }
          });
          document.dispatchEvent(shareEvent);

          // è®°å½•åˆ°æ§åˆ¶å°ï¼ˆè°ƒè¯•ç”¨ï¼‰
          console.log('Social share:', platform, this.href);
        });
      }
    });

    // ç›‘å¬åˆ†äº«äº‹ä»¶ï¼ˆå¯ç”¨äºé›†æˆåˆ†æå·¥å…·ï¼‰
    document.addEventListener('socialShare', function(e) {
      // è¿™é‡Œå¯ä»¥é›†æˆGoogle Analyticsã€Facebook Pixelç­‰åˆ†æå·¥å…·
      if (typeof gtag !== 'undefined') {
        gtag('event', 'share', {
          'method': e.detail.platform,
          'content_type': 'article',
          'item_id': '{{ article.id | default: product.id | default: "" }}'
        });
      }
    });
  });
</script>